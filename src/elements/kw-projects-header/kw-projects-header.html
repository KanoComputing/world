<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<link rel="import" href="../kano-style/typography.html">
<link rel="import" href="../kano-style/color.html">
<link rel="import" href="../kano-session/kano-session.html">
<link rel="import" href="../kano-progress-slide/kano-progress-slide.html">
<link rel="import" href="../kano-step/kano-step.html">
<link rel="import" href="../kw-project-card/kw-project-card.html">

<dom-module id="kw-projects-header">
    <template>
        <style>
            .header {
                @apply --layout-vertical;
                @apply --layout-center;
                text-align: center;
                background-color: #263A48;
                color: #fff;
                padding: 20px 10px 30px;
            }
            .display {
                width: 780px;
                @apply --layout-vertical;
                @apply --layout-center;
            }
            h3 {
                font-size: 32px;
                margin: 10px 0;
            }
            .toggle-container {
                @apply --layout-vertical;
                opacity: 0;
                transform: translateY(100px);
                transition: 300ms ease-out;
            }
            .projects {
                @apply --layout-horizontal;
                flex: 1;
                justify-content: center;
                padding: 0 36px;
                overflow-y: visible;
            }
            .projects > a {
                position: relative;
                margin: 10px 12px;
                text-decoration: none;
            }
            .project-group {
                width: 100%;
                padding-bottom: 8px;
            }
            .project-group iron-image {
                width: 150px;
                height: 90px;
            }
            .project-group iron-image.pixel {
                width: 159px;
                height: 118px;
            }
            .project-group iron-image.screen {
                width: 150px;
                height: 117px;
            }
            .project-group-header {
                @apply --layout-horizontal;
                @apply --layout-end;
            }
            .project-group-info {
                @apply(--layout-vertical);
                text-align: left;
                margin: 0 0 10px 40px;
            }
            .project-group-info h4 {
                font-size: 18px;
                margin: 0;
            }
            .project-group-info p {
                font-size: 16px;
                margin: 0;
            }
            kano-step {
                background-size: 64%;
                background-repeat: no-repeat;
                background-position: center;
                background-color: #263A48;
                flex: 1;
                height: 60px;
                margin: 0 30px;
            }
            kano-step:first-of-type {
                margin-left: 0;
            }
            kano-step[state = "locked"] {
                background-image: url("/assets/projects/simple-progress/lock-circle.svg");
            }
            kano-step[state = "current"] {
                flex: 2.5;
                background-image: url("/assets/projects/simple-progress/make-button.svg");
                background-size: 82%;
            }
            kano-step[state = "done"] {
                background-image: url("/assets/projects/simple-progress/tick-circle.svg");
            }
            kano-progress-slide kano-step:last-of-type[state="locked"] {
                flex: 2.5;
                background-image: url("/assets/projects/simple-progress/lock-circle-large.svg");
                background-size: 70%;
                width: 100px;
                height: 120px;
            }
            kano-progress-slide kano-step:last-of-type[state="done"] {
                flex: 2.5;
                background-image: url("/assets/projects/simple-progress/complete-row.svg");
                background-size: 70%;
                background-position: 50% 75%;
                width: 120px;
                height: 120px;
                padding-top: 20px;
            }
            kano-progress-slide kano-step:last-of-type[state="done"]::done {
                left: -58px;
                width: 10px; 
            }
            @media screen and (min-width: 1600px) {
            }
            @media screen and (max-width: 980px) {
            }
            @media screen and (max-width: 680px) {
            }
        </style>
        <kano-session id="session" user="{{user}}" include-profile></kano-session>
        <div class="header">
            <div class="display">
                <h3>Level up your coding powers</h3>
                <div class="project-group">
                    <div class="project-group-header">
                        <iron-image src="/assets/projects/simple-progress/hello.svg" preload fade sizing="contain" position="bottom"></iron-image>
                        <div class="project-group-info">
                            <h4>Speaker</h4>
                            <p>Write your first lines of code to control your speaker</p>
                        </div>
                    </div>
                    <kano-progress-slide id="fake_group">
                        <div slot="content">
                            <kano-step state="current">
                                <div slot="label">1
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">2
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">3
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">4
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">5
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">6
                                </div>
                            </kano-step>
                            <kano-step state="locked"></kano-step>
                        </div>
                    </kano-progress-slide>
                </div>
                <div class="project-group">
                    <div class="project-group-header">
                        <iron-image src="/assets/projects/modes/canvas-pixel.png" class="pixel" preload fade sizing="contain" position="bottom"></iron-image>
                        <div class="project-group-info">
                            <h4>Pixel kit</h4>
                            <p>Explore pixels, loops, and shapes</p>
                        </div>
                    </div>
                    <kano-progress-slide id="fake_group2">
                        <div slot="content">
                            <kano-step state="current">
                                <div slot="label">1
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">2
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">3
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">4
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">5
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">6
                                </div>
                            </kano-step>
                            <kano-step state="locked"></kano-step>
                        </div>
                    </kano-progress-slide>
                </div>
                <div class="project-group">
                    <div class="project-group-header">
                        <iron-image src="/assets/projects/simple-progress/screen.svg" class="screen" preload fade sizing="contain" position="bottom"></iron-image>
                        <div class="project-group-info">
                            <h4>Screen</h4>
                            <p>Explore pixels, loops, and shapes</p>
                        </div>
                    </div>
                    <kano-progress-slide id="fake_group3">
                        <div slot="content">
                            <kano-step state="current">
                                <div slot="label">1
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">2
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">3
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">4
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">5
                                </div>
                            </kano-step>
                            <kano-step state="locked">
                                <div slot="label">6
                                </div>
                            </kano-step>
                            <kano-step state="locked"></kano-step>
                        </div>
                    </kano-progress-slide>
                </div>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'kw-projects-header',
            properties: {
                projects: {
                    type: Array,
                    value: [{
                        "title": "Code tree",
                        "image": "assets/projects/current-theme/code_tree.png",
                        "link": "https://apps.kano.me/story/code_tree"
                    }, {
                        "title": "Robo wrapper",
                        "image": "assets/projects/current-theme/robo_wrapper.png",
                        "link": "https://apps.kano.me/story/robo_wrapper"
                    }, {
                        "title": "Snow day",
                        "image": "assets/projects/current-theme/snow_day.png",
                        "link": "https://apps.kano.me/story/snow_day"
                    }, {
                        "title": "Sound hat",
                        "image": "assets/projects/current-theme/sound_hat.png",
                        "link": "https://apps.kano.me/story/sound_hat"
                    }]
                },
                completedStories: {
                    type: Array,
                    value: []
                }
            },
            observers: [
                '_computeProgress(user)'
            ],
            ready () {
            },
            _computeProgress (user) {
                console.log('hey computing user progress');
                if (user.profile && user.profile.stats['make-apps'] && user.profile.stats['make-apps'].progress) {
                    Polymer.dom(this.root).querySelectorAll('kano-progress-slide').forEach((el) => {
                        if (user.profile.stats['make-apps'].progress[el.id]) {
                            let steps = el.firstElementChild.children
                            //looping through an HTML collection
                            for (let i = 0, len = steps.length; i < len; i++) {
                                if (i === user.profile.stats['make-apps'].progress[el.id].completedStories.length) {
                                    steps[i].state = "current";
                                } else if (i < user.profile.stats['make-apps'].progress[el.id].completedStories.length - 1) {
                                    steps[i].state = "done";
                                }
                            }
                        } else {
                            //user progress not present
                        }
                    }) 
                }
            },
            _getUserProgress (user) {
                if (user && user.profile && user.profile) {
                    let profile = user.profile;
                    if (profile.stats['make-apps'] && profile.stats['make-apps'].progress && profile.stats['make-apps'].progress['fake_group']) {
                        this.completedStories = profile.stats['make-apps'].progress['fake_group'].completedStories;
                    }
                }
            },
            _getPathPrefix () {
                if (!this.pathPrefix) {
                    let pathEl = document.head.querySelector('meta[name="path-prefix"]');
                    this.pathPrefix = pathEl ? pathEl.getAttribute('data-value') : '/';
                }
                return this.pathPrefix;
            }
        });
    </script>
</dom-module>
