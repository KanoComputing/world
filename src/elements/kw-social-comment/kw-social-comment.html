<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="../kano-api-client/kano-api-client-behavior.html">
<link rel="import" href="../../bower_components/date-util/date-util.html">
<link rel="import" href="../kano-style/color.html">
<link rel="import" href="../kano-style/typography.html">
<dom-module id="kw-social-comment">
    <template>
        <style>
             :host {
                @apply --layout-vertical;
                @apply --layout-center;
            }
            
            [hidden] {
                display: none !important;
            }
            
            .orange-button {
                background-color: var(--color-orange);
                border-radius: 5px;
                width: 79px;
                height: 32px;
                color: var(--color-white);
                border: none;
            }
            
            .comment-button {
                width: 100px;
            }
            
            .comment-button img {
                position: relative;
                top: 2px;
                left: 2px;
            }
            
            .comments-box {
                @apply --layout-vertical;
                @apply --layout-center;
                @apply --layout-justified;
                background-color: var(--color-grey-lightest);
                width: 100%;
                padding-bottom: 54px;
            }
            
            .comments-box h3 {
                color: var(--color-grey-dark);
                margin: 50px;
                font-size: 16px;
                line-height: 43px;
            }
            
            .comments-box .input-comment {
                @apply --layout-horizontal;
                @apply --layout-center;
                width: 80%;
                margin: 32px;
            }
            
            .comment-avatar {
                @apply --layout-flex-1;
                margin-left: 16px;
                margin-right: 16px;
            }

            .comment-avatar img {
                max-height: 35px;
                max-width : 35px;
            }
            
            .comments-box .input-comment .comment-box {
                @apply --layout-horizontal;
                @apply --layout-center;
                border-radius: 3px;
                border: 1px solid var(--color-grey-lighter);
                height: 45px;
                width: 90%;
                padding: 8px;
                background-color: var(--color-grey-lightest);
            }
            
            .comments-box .input-comment .comment-box input {
                width: 80%;
                height: 32px;
                font-size: 14px;
                border: none;
                margin: 8px;
            }
            
            .comments-box .line {
                height: 1px;
                width: 90%;
                display: block;
                background-color: var(--color-white);
                opacity: 0.2;
            }
            
            .comment {
                width: 80%;
                height: 100px;
                @apply --layout-horizontal;
                @apply --layout-center;
            }
            
            .content {
                font-size: 16px;
                font-family: var(--font-body);
                color: var(--color-grey-dark);
                width: 100%;
            }
            
            .content p b {
                margin-right: 6px;
            }
            
            .content p {
                margin-top: 6px;
                margin-bottom: 6px;
            }
            
            .content date-util {
                font-size: 14px;
                font-family: var(--font-body);
                color: var(--color-grey-dark);
            }
            
            .comments-box p {
                font-family: var(--font-body);
                color: var(--color-grey-dark);
                font-size: 16px;
            }
            
            span.bold {
                font-weight: bold;
                margin-right: 5px;
            }
        </style>
        <div class="comments-box">
            <h3 hidden$="{{_computeHidden(comments)}}">Be the first to comment!</h3>
            <div class="line"></div>
            <template is="dom-repeat" items="{{comments}}">
                <div class="comment">
                    <div class="comment-avatar"><img src="{{_getAvatar(item)}}" /></div>
                    <div class="content">
                        <p><span class="bold">{{item.author.username}}</span>{{item.text}}</p>
                        <date-util format="H:mm , dd Mon yyyy" date="[[_createDate(item.date_created)]]"></date-util>
                    </div>
                </div>
            </template>
            <div class="line"></div>
            <div class="input-comment">
                <div class="comment-avatar"><img src="{{_getAvatar(item)}}" /></div>
                <div class="comment-box">
                    <input id="comment" type="text" placeholder="Type your message ...">
                    <button class="orange-button comment-button" on-tap="_tapPostButton">comment <img src="/assets/icons/shares/comment.svg" /></button>
                </div>
            </div>
            <p>Remember to be nice</p>
        </div>
    </template>
    <script>
        Polymer({
            is: 'kw-social-comment',
            properties: {
                comments: {
                    type: Array,
                    value:[]
                }
            },
             _computeHidden(){
                 return this.comments.length > 0;
            },
            _getAvatar(item){
                return item.author.avatar.urls.circle || "/assets/icons/shares/commentAvatar.svg";
            },
            attached () {
            },
            _tapPostButton(){
                var commentText = this.$.comment.value;
                this.fire("post-comment",{text:commentText});
            },
            _createDate (formatted) {
                return new Date(formatted);
            }
        });
    </script>
</dom-module>